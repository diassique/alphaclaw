<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlphaClaw â€” AI Alpha Marketplace</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #050508;
      --bg2: #0c0c12;
      --bg3: #13131d;
      --border: #1e1e2e;
      --border2: #2a2a3e;
      --accent: #7c3aed;
      --accent2: #a855f7;
      --accent3: #06b6d4;
      --green: #10b981;
      --yellow: #f59e0b;
      --red: #ef4444;
      --text: #e2e8f0;
      --text2: #94a3b8;
      --text3: #475569;
      --mono: 'Space Mono', monospace;
      --sans: 'Space Grotesk', sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated grid background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(124,58,237,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(124,58,237,.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* Glow orbs */
    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(120px);
      pointer-events: none;
      z-index: 0;
      opacity: .15;
    }
    .orb1 { width: 600px; height: 600px; background: var(--accent); top: -200px; left: -200px; }
    .orb2 { width: 400px; height: 400px; background: var(--accent3); bottom: -100px; right: -100px; }

    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(5,5,8,.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 2rem;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: .75rem;
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: -.02em;
    }
    .logo-icon {
      width: 32px; height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-icon img { width: 100%; height: 100%; }
    .logo-sub { color: var(--text2); font-size: .75rem; font-weight: 400; font-family: var(--mono); }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .3rem .75rem;
      border-radius: 100px;
      font-size: .75rem;
      font-family: var(--mono);
      font-weight: 700;
    }
    .badge-green { background: rgba(16,185,129,.1); border: 1px solid rgba(16,185,129,.3); color: var(--green); }
    .badge-yellow { background: rgba(245,158,11,.1); border: 1px solid rgba(245,158,11,.3); color: var(--yellow); }
    .badge-red { background: rgba(239,68,68,.1); border: 1px solid rgba(239,68,68,.3); color: var(--red); }
    .badge-purple { background: rgba(124,58,237,.15); border: 1px solid rgba(124,58,237,.3); color: var(--accent2); }
    .dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:.4;} }

    /* â”€â”€â”€ Status Strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-strip {
      background: var(--bg2);
      border-top: 1px solid var(--border);
      padding: .5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      font-size: .75rem;
      font-family: var(--mono);
      color: var(--text2);
      z-index: 99;
      position: sticky;
      bottom: 0;
      flex-wrap: wrap;
    }
    .status-strip-left {
      display: flex;
      align-items: center;
      gap: .5rem;
    }
    .status-indicator {
      width: 8px; height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .status-indicator.ok { background: var(--green); box-shadow: 0 0 8px var(--green); animation: pulse 2s infinite; }
    .status-indicator.degraded { background: var(--yellow); box-shadow: 0 0 8px var(--yellow); animation: pulse 1s infinite; }
    .status-indicator.offline { background: var(--red); box-shadow: 0 0 8px var(--red); }
    .status-indicator.loading { background: var(--text3); animation: pulse 1s infinite; }
    .status-label { font-weight: 700; }
    .status-label.ok { color: var(--green); }
    .status-label.degraded { color: var(--yellow); }
    .status-label.offline { color: var(--red); }
    .status-label.loading { color: var(--text3); }
    .status-dots {
      display: flex;
      align-items: center;
      gap: .35rem;
    }
    .status-dot {
      width: 18px; height: 18px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .55rem;
      font-weight: 700;
      cursor: default;
      transition: all .2s;
      position: relative;
    }
    .status-dot.ok { background: rgba(16,185,129,.15); border: 1px solid rgba(16,185,129,.3); color: var(--green); }
    .status-dot.error, .status-dot.offline { background: rgba(239,68,68,.15); border: 1px solid rgba(239,68,68,.3); color: var(--red); }
    .status-dot.unknown { background: rgba(71,85,105,.15); border: 1px solid rgba(71,85,105,.3); color: var(--text3); }
    .status-dot:hover { transform: scale(1.2); }
    .status-dot .tooltip {
      display: none;
      position: absolute;
      bottom: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: .5rem .75rem;
      font-size: .7rem;
      white-space: nowrap;
      z-index: 10;
      color: var(--text);
      font-weight: 400;
      box-shadow: 0 4px 12px rgba(0,0,0,.4);
    }
    .status-dot:hover .tooltip { display: block; }
    .status-meta {
      font-size: .7rem;
      color: var(--text3);
    }
    .status-countdown {
      width: 16px; height: 16px;
      border-radius: 50%;
      border: 2px solid var(--border2);
      border-top-color: var(--accent);
      display: inline-block;
      vertical-align: middle;
      animation: spin 10s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    main {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 4rem 0 3rem;
    }
    .hero-label {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      background: rgba(124,58,237,.1);
      border: 1px solid rgba(124,58,237,.2);
      border-radius: 100px;
      padding: .4rem 1rem;
      font-size: .75rem;
      font-family: var(--mono);
      color: var(--accent2);
      margin-bottom: 1.5rem;
    }
    .hero h1 {
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 700;
      letter-spacing: -.04em;
      line-height: 1.05;
      margin-bottom: 1.25rem;
    }
    .hero h1 span {
      background: linear-gradient(135deg, var(--accent2), var(--accent3));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p {
      font-size: 1.15rem;
      color: var(--text2);
      max-width: 560px;
      margin: 0 auto 2.5rem;
      line-height: 1.6;
    }

    .hero-actions {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .75rem 1.5rem;
      border-radius: 10px;
      font-family: var(--sans);
      font-size: .9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      border: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #6d28d9);
      color: #fff;
      box-shadow: 0 0 30px rgba(124,58,237,.4);
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 40px rgba(124,58,237,.6); }
    .btn-secondary {
      background: var(--bg3);
      color: var(--text);
      border: 1px solid var(--border2);
    }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent2); }

    /* Stats bar */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1px;
      background: var(--border);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 3rem;
    }
    .stat {
      background: var(--bg2);
      padding: 1.25rem 1.5rem;
      text-align: center;
    }
    .stat-val {
      font-size: 1.6rem;
      font-weight: 700;
      font-family: var(--mono);
      background: linear-gradient(135deg, var(--accent2), var(--accent3));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .stat-label { font-size: .75rem; color: var(--text3); margin-top: .25rem; text-transform: uppercase; letter-spacing: .05em; }

    /* Hunt form */
    .hunt-section {
      margin-bottom: 3rem;
    }
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: .5rem;
      color: var(--text2);
    }
    .section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .hunt-box {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
    }
    .hunt-input-row {
      display: flex;
      gap: .75rem;
    }
    .hunt-input {
      flex: 1;
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: 10px;
      padding: .75rem 1rem;
      font-family: var(--sans);
      font-size: .95rem;
      color: var(--text);
      outline: none;
      transition: border-color .2s;
    }
    .hunt-input:focus { border-color: var(--accent); }
    .hunt-input::placeholder { color: var(--text3); }

    .quick-topics {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
      margin-top: .75rem;
    }
    .topic-chip {
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: 100px;
      padding: .3rem .75rem;
      font-size: .75rem;
      color: var(--text2);
      cursor: pointer;
      transition: all .15s;
      font-family: var(--mono);
    }
    .topic-chip:hover { border-color: var(--accent); color: var(--accent2); background: rgba(124,58,237,.05); }

    /* Stream output */
    #stream-output {
      margin-top: 1rem;
      display: none;
    }
    .stream-log {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
      font-family: var(--mono);
      font-size: .78rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .stream-log::-webkit-scrollbar { width: 4px; }
    .stream-log::-webkit-scrollbar-track { background: transparent; }
    .stream-log::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    .log-line {
      padding: .2rem 0;
      display: flex;
      align-items: flex-start;
      gap: .75rem;
      border-bottom: 1px solid rgba(30,30,46,.5);
    }
    .log-line:last-child { border-bottom: none; }
    .log-time { color: var(--text3); white-space: nowrap; flex-shrink: 0; }
    .log-pay  { color: var(--yellow); }
    .log-ok   { color: var(--green); }
    .log-alpha{ color: var(--accent2); }
    .log-err  { color: var(--red); }

    /* Alpha result card */
    .alpha-result {
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: 12px;
      padding: 1.25rem;
      margin-top: 1rem;
      display: none;
    }
    .alpha-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .alpha-rec {
      font-size: 1rem;
      font-weight: 600;
    }
    .alpha-conf {
      font-family: var(--mono);
      font-size: .85rem;
      color: var(--text2);
    }
    .alpha-signals {
      display: flex;
      gap: .4rem;
      flex-wrap: wrap;
    }
    .signal-tag {
      background: rgba(124,58,237,.1);
      border: 1px solid rgba(124,58,237,.2);
      border-radius: 6px;
      padding: .2rem .5rem;
      font-family: var(--mono);
      font-size: .7rem;
      color: var(--accent2);
    }

    /* Reports grid */
    .reports-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 1rem;
      margin-bottom: 3rem;
    }

    .report-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all .2s;
      position: relative;
      overflow: hidden;
    }
    .report-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(124,58,237,.05), transparent);
      opacity: 0;
      transition: opacity .2s;
    }
    .report-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .report-card:hover::before { opacity: 1; }

    .report-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: .75rem;
    }
    .report-id {
      font-family: var(--mono);
      font-size: .7rem;
      color: var(--text3);
    }
    .report-price {
      font-family: var(--mono);
      font-size: .75rem;
      color: var(--green);
      background: rgba(16,185,129,.08);
      border: 1px solid rgba(16,185,129,.2);
      border-radius: 6px;
      padding: .2rem .5rem;
    }
    .report-topic {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: .5rem;
      color: var(--text);
    }
    .report-preview {
      font-size: .82rem;
      color: var(--text2);
      line-height: 1.5;
      margin-bottom: 1rem;
    }
    .report-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .report-time { font-size: .72rem; color: var(--text3); font-family: var(--mono); }

    /* Services status */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: .75rem;
      margin-bottom: 3rem;
    }
    .service-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.15rem;
      display: flex;
      align-items: flex-start;
      gap: .75rem;
      transition: all .2s;
    }
    .service-card:hover { border-color: var(--border2); }
    .service-card.svc-ok { }
    .service-card.svc-err { }
    .service-card.svc-off { }
    .service-status { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 5px; }
    .status-ok { background: var(--green); box-shadow: 0 0 8px var(--green); }
    .status-err { background: var(--red); box-shadow: 0 0 8px var(--red); }
    .status-off { background: var(--text3); }
    .service-info { flex: 1; min-width: 0; }
    .service-name { font-size: .82rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .service-details {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin-top: .3rem;
    }
    .service-price { font-size: .7rem; color: var(--text3); font-family: var(--mono); }
    .service-latency {
      font-size: .65rem;
      font-family: var(--mono);
      color: var(--text3);
      background: var(--bg3);
      border-radius: 4px;
      padding: .1rem .35rem;
    }
    .service-latency.fast { color: var(--green); }
    .service-latency.medium { color: var(--yellow); }
    .service-latency.slow { color: var(--red); }
    .service-port {
      font-size: .65rem;
      font-family: var(--mono);
      color: var(--text3);
    }

    /* Tx feed */
    .tx-feed {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 3rem;
    }
    .tx-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .tx-title { font-weight: 600; font-size: .9rem; }
    .tx-item {
      padding: .85rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 1rem;
      font-family: var(--mono);
      font-size: .75rem;
      transition: background .15s;
    }
    .tx-item:last-child { border-bottom: none; }
    .tx-item:hover { background: var(--bg3); }
    .tx-dir { color: var(--text3); }
    .tx-amount { color: var(--green); font-weight: 700; margin-left: auto; }
    .tx-hash { color: var(--text3); }
    .tx-addr { color: var(--accent2); }
    .tx-empty {
      padding: 2rem;
      text-align: center;
      color: var(--text3);
      font-size: .85rem;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.8);
      backdrop-filter: blur(8px);
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: 20px;
      width: 100%;
      max-width: 640px;
      max-height: 85vh;
      overflow-y: auto;
      padding: 2rem;
    }
    .modal h2 { font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; }
    .modal-close {
      float: right;
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: 8px;
      color: var(--text2);
      padding: .4rem .75rem;
      cursor: pointer;
      font-family: var(--sans);
      font-size: .85rem;
      transition: all .15s;
    }
    .modal-close:hover { color: var(--text); border-color: var(--text2); }

    .report-detail-section { margin-bottom: 1.5rem; }
    .report-detail-label {
      font-size: .72rem;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: .08em;
      margin-bottom: .5rem;
    }
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: .6rem 0;
      border-bottom: 1px solid var(--border);
      font-size: .83rem;
    }
    .breakdown-item:last-child { border-bottom: none; }
    .breakdown-key { color: var(--text2); }
    .breakdown-val { color: var(--text); font-family: var(--mono); font-size: .78rem; max-width: 55%; text-align: right; }

    .buy-cta {
      background: linear-gradient(135deg, var(--bg3), var(--bg));
      border: 1px solid var(--border2);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      margin-top: 1rem;
    }
    .buy-cta p { color: var(--text2); font-size: .85rem; margin-bottom: 1rem; }

    footer {
      position: relative;
      z-index: 1;
      border-top: 1px solid var(--border);
      padding: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: gap;
      color: var(--text3);
      font-size: .78rem;
      font-family: var(--mono);
    }

    /* Reputation grid */
    .rep-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: .75rem;
      margin-bottom: 3rem;
    }
    .rep-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.15rem;
      transition: all .3s;
    }
    .rep-card.staked { animation: stakeGlow .6s ease; }
    .rep-card.rewarded { border-color: var(--green); box-shadow: 0 0 12px rgba(16,185,129,.15); }
    .rep-card.slashed { border-color: var(--red); box-shadow: 0 0 12px rgba(239,68,68,.15); }
    @keyframes stakeGlow {
      0% { box-shadow: 0 0 0 rgba(124,58,237,0); }
      50% { box-shadow: 0 0 20px rgba(124,58,237,.3); }
      100% { box-shadow: 0 0 0 rgba(124,58,237,0); }
    }
    .rep-name { font-size: .82rem; font-weight: 600; margin-bottom: .5rem; }
    .rep-score {
      font-family: var(--mono);
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: .4rem;
    }
    .rep-bar-outer {
      height: 4px;
      background: var(--bg3);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: .5rem;
    }
    .rep-bar-fill {
      height: 100%;
      border-radius: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width .5s ease;
    }
    .rep-stats {
      display: flex;
      justify-content: space-between;
      font-size: .7rem;
      color: var(--text3);
      font-family: var(--mono);
    }
    .rep-pnl-pos { color: var(--green); }
    .rep-pnl-neg { color: var(--red); }
    .rep-sparkline { margin-top: .4rem; }
    .rep-sparkline svg { display: block; width: 100%; height: 24px; }
    .rep-sparkline polyline { fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }

    /* Staking results card */
    .stake-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 3rem;
      display: none;
    }
    .stake-card.visible { display: block; }
    .stake-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .stake-title { font-weight: 600; font-size: .9rem; }
    .consensus-badge {
      font-family: var(--mono);
      font-size: .75rem;
      padding: .2rem .6rem;
      border-radius: 6px;
      font-weight: 600;
    }
    .consensus-bullish { background: rgba(16,185,129,.1); border: 1px solid rgba(16,185,129,.3); color: var(--green); }
    .consensus-bearish { background: rgba(239,68,68,.1); border: 1px solid rgba(239,68,68,.3); color: var(--red); }
    .consensus-neutral { background: rgba(245,158,11,.1); border: 1px solid rgba(245,158,11,.3); color: var(--yellow); }
    .stake-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .5rem 0;
      border-bottom: 1px solid var(--border);
      font-size: .8rem;
      font-family: var(--mono);
    }
    .stake-row:last-child { border-bottom: none; }
    .stake-svc { color: var(--text2); min-width: 100px; }
    .stake-dir { font-size: .7rem; padding: .15rem .4rem; border-radius: 4px; }
    .stake-dir.bullish { background: rgba(16,185,129,.1); color: var(--green); }
    .stake-dir.bearish { background: rgba(239,68,68,.1); color: var(--red); }
    .stake-dir.neutral { background: rgba(245,158,11,.1); color: var(--yellow); }
    .stake-num { text-align: right; min-width: 60px; }
    .stake-correct { color: var(--green); }
    .stake-incorrect { color: var(--red); }

    /* Competition card */
    .comp-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 3rem;
      display: none;
    }
    .comp-card.visible { display: block; }
    .comp-header { font-weight: 600; font-size: .9rem; margin-bottom: 1rem; }
    .comp-matchup {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .comp-agent {
      flex: 1;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: .75rem;
      text-align: center;
      transition: all .3s;
    }
    .comp-agent.winner {
      border-color: var(--green);
      box-shadow: 0 0 12px rgba(16,185,129,.15);
    }
    .comp-agent.loser {
      opacity: .5;
      border-color: var(--red);
    }
    .comp-agent-name { font-size: .82rem; font-weight: 600; margin-bottom: .3rem; }
    .comp-agent-ratio { font-family: var(--mono); font-size: 1.1rem; font-weight: 700; }
    .comp-vs {
      font-family: var(--mono);
      font-size: .85rem;
      color: var(--text3);
      flex-shrink: 0;
    }
    .comp-reason {
      font-size: .75rem;
      color: var(--text2);
      font-family: var(--mono);
      text-align: center;
      margin-top: .75rem;
    }

    /* Dynamic price indicator */
    .price-dynamic { font-size: .6rem; color: var(--accent2); margin-left: .25rem; }
    .price-discount { color: var(--green); }
    .price-premium { color: var(--red); }

    @media (max-width: 600px) {
      main { padding: 1rem; }
      .hero { padding: 2rem 0; }
      .hero h1 { font-size: 2rem; }
      .hunt-input-row { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <nav>
    <div class="logo">
      <div class="logo-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80.98 71.25" width="32" height="28"><path fill="#7650ef" d="M11.57,85.62,18.13,72S16.88,64.14,22,55.2C22,55.2,3.45,65.62,11.57,85.62Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M27,85.62s-9.82-7.88-5.7-23.1S39.58,41,42.63,40.38a5.28,5.28,0,0,0-1.42.93A37.45,37.45,0,0,0,37.77,44a29,29,0,0,0-8.6,12.46,47.09,47.09,0,0,0-1.92,10.4c-.36,4-.47,8-.46,12,0,2.19.06,4.38.17,6.57C27,85.5,27,85.61,27,85.62Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M37.72,85.62V67c0-4-.15-8.05.15-12a28.35,28.35,0,0,1,.82-5.11,19.12,19.12,0,0,1,4.53-8.32S32.93,48.6,30.57,58.84,29.47,79.34,37.72,85.62Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M51.86,57.85a14.77,14.77,0,0,0-5,3.94A18.78,18.78,0,0,0,43,69.48a25.35,25.35,0,0,1-1.58-22Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M82.64,73C82.42,74.45,75.87,85.62,63,85.62S44.71,72.24,44.71,72.24a17,17,0,0,1,2.57-7.47c2.39-3.72,7-7.33,15.87-6.77-1.29,2.61-2.87,8.09,2.59,13.36,7.48,7.22,16.73,1.73,16.9,1.63Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M79.48,68.34h0c-6.34-2.79-13,1.4-13,1.4a11,11,0,0,1-2.72-5.62A8.9,8.9,0,0,1,65,58.2C77.21,60.26,79.41,68.09,79.48,68.34Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M39.48,20.1S18.82,19.26,11.61,41c0,0-2.74-12.93,8.46-20,11-6.93,19.08-1.15,19.4-.92Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M63.42,32c-4.19-1.26-5.79.95-6.37,2.48a1,1,0,0,1-1,.68A1,1,0,0,1,55.5,35a1,1,0,0,1-.38-.47,5.42,5.42,0,0,0-2-2.67,4.48,4.48,0,0,0-5.69,1A4.7,4.7,0,0,0,46.57,36a3.4,3.4,0,0,0,.08.64c-16.51,3.83-22.39,15-22.39,15a22.11,22.11,0,0,0-11,8.09C10.05,49.34,14.1,29.34,34,23.49,51.86,18.26,63.42,32,63.42,32Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M81.19,48.56A30.4,30.4,0,0,1,61.51,54a10.44,10.44,0,0,0,2-2.18,22.34,22.34,0,0,0,2.41-4.4,11,11,0,0,0,5.47-4,8.1,8.1,0,0,0,2.86,3A13.56,13.56,0,0,0,81.19,48.56Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M79,31.74,75.2,33,71,34.3C70.3,26,74,23,74.11,22.9h0A15.53,15.53,0,0,0,79,31.74Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M85.4,46.58a16.37,16.37,0,0,1-5.35-.52,12.62,12.62,0,0,1-8.7-9l10.16-3.37L77,19.15s11.52,1.71,13.24,12.3A16.86,16.86,0,0,1,85.4,46.58Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M59.65,37.39c.58-1.19,1.51-1.91,2.08-1.63s.58,1.46,0,2.63S60.23,40.3,59.66,40,59.08,38.56,59.65,37.39Zm-8.89-2c.67,0,1.25,1,1.3,2.24S51.62,39.92,51,40s-1.24-1-1.3-2.25S50.1,35.38,50.76,35.35Zm8.42,7.76a12.71,12.71,0,0,0,1.39-1.31,16.55,16.55,0,0,0,1.73-2.33,5.3,5.3,0,0,0,1-3.56,2.21,2.21,0,0,0-2-1.61c-1.15,0-2,1.33-2.51,2.27C58,38,57.35,39.39,56.68,40.84c-.21.47-.41.94-.62,1.42a6.91,6.91,0,0,0-.35.85c-1.13,0-2.34.12-3.57.26A13.55,13.55,0,0,0,52.82,41a14.58,14.58,0,0,0,.39-2.88,4.81,4.81,0,0,0-1-3.6A2.11,2.11,0,0,0,49.79,34c-1.12.55-1.18,2.14-1.18,3.2A47.53,47.53,0,0,0,48.9,42c.06.52.11,1,.18,1.54a2.3,2.3,0,0,0,0,.26,28.5,28.5,0,0,0-6.26,1.85L54,56.82s8.69-4.64,9.83-13.37A45.55,45.55,0,0,0,59.18,43.11Z" transform="translate(-9.51 -14.38)"/><path fill="#7650ef" d="M22.13,17a20.33,20.33,0,0,0-4.9,2.43c-4.39,3-5.34,6.44-5.34,6.44-.2-.49-2.31-6.08-.46-11.4A17.16,17.16,0,0,1,22,16.92l.06,0Z" transform="translate(-9.51 -14.38)"/></svg></div>
      <div>
        AlphaClaw
        <div class="logo-sub">AI Alpha Marketplace</div>
      </div>
    </div>
    <div class="nav-right">
      <span class="badge badge-green"><span class="dot"></span> LIVE</span>
      <span class="badge badge-purple">Base Sepolia Â· x402</span>
    </div>
  </nav>

  <main>
    <!-- Hero -->
    <div class="hero">
      <div class="hero-label">âš¡ SURGE Ã— OpenClaw Hackathon 2026</div>
      <h1>The <span>Alpha Marketplace</span><br/>for AI Agents</h1>
      <p>5 autonomous agents buy and sell intelligence via x402 micropayments. One query. Five data sources. Real on-chain transactions.</p>
      <div class="hero-actions">
        <button class="btn btn-primary" onclick="scrollToHunt()">ğŸ” Hunt Alpha</button>
        <button class="btn btn-secondary" onclick="document.getElementById('services-section').scrollIntoView({behavior:'smooth'})">ğŸ“Š Network Status</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats" id="stats">
      <div class="stat">
        <div class="stat-val" id="stat-services">6</div>
        <div class="stat-label">Active Agents</div>
      </div>
      <div class="stat">
        <div class="stat-val" id="stat-reports">â€”</div>
        <div class="stat-label">Cached Reports</div>
      </div>
      <div class="stat">
        <div class="stat-val">$0.039</div>
        <div class="stat-label">Buy Cost</div>
      </div>
      <div class="stat">
        <div class="stat-val">$0.050</div>
        <div class="stat-label">Sell Price</div>
      </div>
      <div class="stat">
        <div class="stat-val" style="color: var(--green);">$0.011</div>
        <div class="stat-label">Margin / Hunt</div>
      </div>
      <div class="stat">
        <div class="stat-val" id="stat-reputation" style="color: var(--accent2);">â€”</div>
        <div class="stat-label">Avg Reputation</div>
      </div>
      <div class="stat">
        <div class="stat-val" id="stat-pnl" style="color: var(--text2);">â€”</div>
        <div class="stat-label">Economy P&L</div>
      </div>
    </div>

    <!-- Hunt -->
    <div class="hunt-section" id="hunt">
      <div class="section-title">ğŸ” Run a Hunt</div>
      <div class="hunt-box">
        <div class="hunt-input-row">
          <input class="hunt-input" id="hunt-topic" type="text"
            placeholder="e.g. Trump impeachment 2026, Fed rate cut, Bitcoin ETF..." />
          <button class="btn btn-primary" id="hunt-btn" onclick="runHunt()">Hunt â†’</button>
        </div>
        <div class="quick-topics">
          <span class="topic-chip" onclick="setTopic(this)">Trump impeachment</span>
          <span class="topic-chip" onclick="setTopic(this)">Fed rate cut March</span>
          <span class="topic-chip" onclick="setTopic(this)">Bitcoin ETF approval</span>
          <span class="topic-chip" onclick="setTopic(this)">Ethereum DeFi</span>
          <span class="topic-chip" onclick="setTopic(this)">Base L2 yields</span>
        </div>

        <div id="stream-output">
          <div class="stream-log" id="stream-log"></div>
          <div class="alpha-result" id="alpha-result">
            <div class="alpha-header">
              <div class="alpha-rec" id="alpha-rec"></div>
              <div class="alpha-conf" id="alpha-conf"></div>
            </div>
            <div class="alpha-signals" id="alpha-signals"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reputation -->
    <div class="section-title" id="reputation-section">ğŸ† Agent Reputation</div>
    <div class="rep-grid" id="rep-grid">
      <div style="color: var(--text3); font-size:.85rem; grid-column:1/-1; padding:1rem; text-align:center;">Loading reputations...</div>
    </div>

    <!-- Competition -->
    <div class="comp-card" id="comp-card">
      <div class="comp-header">âš”ï¸ Sentiment Agent Competition</div>
      <div class="comp-matchup">
        <div class="comp-agent" id="comp-agent1">
          <div class="comp-agent-name">ğŸ’¬ Sentiment v1</div>
          <div class="comp-agent-ratio" id="comp-ratio1">â€”</div>
        </div>
        <div class="comp-vs">VS</div>
        <div class="comp-agent" id="comp-agent2">
          <div class="comp-agent-name">ğŸ’¬ Sentiment v2</div>
          <div class="comp-agent-ratio" id="comp-ratio2">â€”</div>
        </div>
      </div>
      <div class="comp-reason" id="comp-reason"></div>
    </div>

    <!-- Staking Results -->
    <div class="stake-card" id="stake-card">
      <div class="stake-header">
        <span class="stake-title">âš–ï¸ Latest Staking Results</span>
        <span class="consensus-badge" id="consensus-badge">â€”</span>
      </div>
      <div id="stake-rows"></div>
    </div>

    <!-- Services -->
    <div class="section-title" id="services-section">âš™ï¸ Network Services</div>
    <div class="services-grid" id="services-grid">
      <div class="service-card">
        <div class="service-status status-off"></div>
        <div class="service-info">
          <div class="service-name">Loading...</div>
          <div class="service-price">checking</div>
        </div>
      </div>
    </div>

    <!-- Reports -->
    <div class="section-title">ğŸ“¦ Available Reports</div>
    <div id="reports-container">
      <div class="reports-grid" id="reports-grid">
        <div style="color: var(--text3); font-size:.85rem; grid-column:1/-1; padding:2rem; text-align:center;">
          No reports yet â€” run a hunt to generate one
        </div>
      </div>
    </div>

    <!-- Tx Feed -->
    <div class="section-title">âš¡ Recent Transactions</div>
    <div class="tx-feed">
      <div class="tx-header">
        <span class="tx-title">x402 Payment Stream</span>
        <span class="badge badge-green" style="font-size:.7rem;"><span class="dot"></span> Base Sepolia</span>
      </div>
      <div id="tx-list">
        <div class="tx-empty">Transactions will appear here after a hunt</div>
      </div>
    </div>
  </main>

  <!-- Report Modal -->
  <div class="modal-overlay" id="modal" onclick="closeModal(event)">
    <div class="modal" id="modal-content">
      <button class="modal-close" onclick="closeModal()">âœ• Close</button>
      <h2 id="modal-title">Alpha Report</h2>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Real-time Status Strip -->
  <div class="status-strip" id="status-strip">
    <div class="status-strip-left">
      <div class="status-indicator loading" id="strip-indicator"></div>
      <span class="status-label loading" id="strip-label">Checking...</span>
    </div>
    <div class="status-dots" id="strip-dots">
      <!-- populated by JS -->
    </div>
    <div class="status-meta">
      <span id="strip-latency">--</span>
      &middot;
      <span id="strip-checked">checking</span>
      &middot;
      <span class="status-countdown" id="strip-countdown"></span>
    </div>
  </div>

  <footer>
    <span>ğŸ¾ AlphaClaw Network Â· Base Sepolia Â· x402</span>
    <span>SURGE Ã— OpenClaw Hackathon 2026</span>
  </footer>

  <script>
    const API = '';
    let txLog = [];
    let latestStaking = null;

    // â”€â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function timeAgo(iso) {
      const d = Math.floor((Date.now() - new Date(iso)) / 1000);
      if (d < 60) return `${d}s ago`;
      if (d < 3600) return `${Math.floor(d/60)}m ago`;
      return `${Math.floor(d/3600)}h ago`;
    }

    function shortAddr(addr) {
      return addr ? addr.slice(0,6) + 'â€¦' + addr.slice(-4) : 'â€”';
    }

    function shortHash(h) {
      return h ? h.slice(0,10) + 'â€¦' : 'â€”';
    }

    function setTopic(el) {
      document.getElementById('hunt-topic').value = el.textContent;
    }

    function scrollToHunt() {
      document.getElementById('hunt').scrollIntoView({ behavior: 'smooth' });
      setTimeout(() => document.getElementById('hunt-topic').focus(), 400);
    }

    // â”€â”€â”€ Load services status + status strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const POLL_INTERVAL = 10_000;
    let lastHealthData = null;

    function latencyClass(ms) {
      if (ms < 100) return 'fast';
      if (ms < 500) return 'medium';
      return 'slow';
    }

    function statusIcon(status) {
      return status === 'ok' ? '&#10003;' : '&#10007;';
    }

    function updateStatusStrip(data) {
      const indicator = document.getElementById('strip-indicator');
      const label = document.getElementById('strip-label');
      const dots = document.getElementById('strip-dots');
      const latency = document.getElementById('strip-latency');
      const checked = document.getElementById('strip-checked');

      // Overall status
      const cls = data.ok ? 'ok' : data.onlineCount > 0 ? 'degraded' : 'offline';
      const labelText = data.ok ? 'ALL OPERATIONAL' : data.onlineCount > 0 ? `DEGRADED (${data.onlineCount}/${data.totalCount})` : 'OFFLINE';

      indicator.className = `status-indicator ${cls}`;
      label.className = `status-label ${cls}`;
      label.textContent = labelText;
      latency.textContent = `avg ${data.avgLatencyMs}ms`;
      checked.textContent = `updated ${new Date(data.checkedAt).toLocaleTimeString('en', {hour12: false})}`;

      // Service dots
      dots.innerHTML = data.services.map(s => {
        const dotCls = s.status === 'ok' ? 'ok' : s.status === 'error' ? 'error' : 'offline';
        const name = s.name.replace('alphaclaw-', '').replace('-alpha-scanner', '');
        return `
          <div class="status-dot ${dotCls}" title="${s.name}">
            <span>${statusIcon(s.status)}</span>
            <div class="tooltip">
              <strong>${s.name}</strong><br/>
              Port ${s.port} &middot; ${s.latencyMs}ms<br/>
              ${s.price ? s.price + ' USDC' : 'coordinator'}<br/>
              Status: <span style="color:var(${s.status === 'ok' ? '--green' : '--red'})">${s.status.toUpperCase()}</span>
            </div>
          </div>`;
      }).join('');
    }

    function updateServicesGrid(data) {
      const grid = document.getElementById('services-grid');
      grid.innerHTML = data.services.map(s => {
        const statusCls = s.status === 'ok' ? 'ok' : s.status === 'error' ? 'err' : 'off';
        const latCls = latencyClass(s.latencyMs);
        const name = s.name.replace('alphaclaw-', '');
        return `
          <div class="service-card svc-${statusCls}">
            <div class="service-status status-${statusCls}"></div>
            <div class="service-info">
              <div class="service-name">${name}</div>
              <div class="service-details">
                <span class="service-price">${s.price || 'coordinator'}</span>
                <span class="service-latency ${latCls}">${s.latencyMs}ms</span>
                <span class="service-port">:${s.port}</span>
              </div>
            </div>
          </div>`;
      }).join('');
    }

    async function loadServices() {
      try {
        const r = await fetch('/health-all');
        const d = await r.json();
        lastHealthData = d;

        updateStatusStrip(d);
        updateServicesGrid(d);

        document.getElementById('stat-services').textContent = d.onlineCount;

        // Update nav badge
        const navBadge = document.querySelector('.nav-right .badge-green');
        if (navBadge) {
          if (d.ok) {
            navBadge.className = 'badge badge-green';
            navBadge.innerHTML = '<span class="dot"></span> LIVE';
          } else if (d.onlineCount > 0) {
            navBadge.className = 'badge badge-yellow';
            navBadge.innerHTML = '<span class="dot"></span> DEGRADED';
          } else {
            navBadge.className = 'badge badge-red';
            navBadge.innerHTML = '<span class="dot"></span> OFFLINE';
          }
        }
      } catch(e) {
        // Total failure â€” can't reach coordinator
        const indicator = document.getElementById('strip-indicator');
        const label = document.getElementById('strip-label');
        indicator.className = 'status-indicator offline';
        label.className = 'status-label offline';
        label.textContent = 'UNREACHABLE';
        document.getElementById('strip-dots').innerHTML = '';
        document.getElementById('strip-latency').textContent = '--';
        document.getElementById('strip-checked').textContent = 'failed';

        document.getElementById('services-grid').innerHTML =
          '<div style="color:var(--red);font-size:.8rem;padding:1rem;text-align:center;grid-column:1/-1">Failed to reach coordinator</div>';
      }
    }

    // â”€â”€â”€ Load reports â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function loadReports() {
      try {
        const r = await fetch('/reports');
        const d = await r.json();
        document.getElementById('stat-reports').textContent = d.count;
        const grid = document.getElementById('reports-grid');
        if (!d.reports.length) {
          grid.innerHTML = '<div style="color:var(--text3);font-size:.85rem;grid-column:1/-1;padding:2rem;text-align:center;">No reports yet â€” run a hunt to generate one</div>';
          return;
        }
        grid.innerHTML = d.reports.map(rep => `
          <div class="report-card" onclick="openReport('${rep.id}')">
            <div class="report-meta">
              <span class="report-id">#${rep.id}</span>
              <span class="report-price">${rep.price}</span>
            </div>
            <div class="report-topic">${rep.topic}</div>
            <div class="report-preview">${rep.preview}</div>
            <div class="report-footer">
              <span class="report-time">${timeAgo(rep.timestamp)}</span>
              <span class="badge badge-purple" style="font-size:.68rem;">Buy via x402</span>
            </div>
          </div>
        `).join('');
      } catch(e) {}
    }

    // â”€â”€â”€ Hunt (SSE stream) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function addLog(cls, icon, msg) {
      const log = document.getElementById('stream-log');
      const time = new Date().toLocaleTimeString('en', {hour12:false});
      const line = document.createElement('div');
      line.className = `log-line log-${cls}`;
      line.innerHTML = `<span class="log-time">${time}</span><span>${icon} ${msg}</span>`;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
    }

    function runHunt() {
      const topic = document.getElementById('hunt-topic').value.trim();
      if (!topic) { document.getElementById('hunt-topic').focus(); return; }

      const btn = document.getElementById('hunt-btn');
      btn.disabled = true;
      btn.textContent = 'Huntingâ€¦';

      const output = document.getElementById('stream-output');
      const log = document.getElementById('stream-log');
      const result = document.getElementById('alpha-result');
      output.style.display = 'block';
      result.style.display = 'none';
      log.innerHTML = '';

      addLog('ok', 'ğŸš€', `Starting hunt: "${topic}"`);

      const sse = new EventSource(`/stream?topic=${encodeURIComponent(topic)}`);

      sse.addEventListener('start', e => {
        const d = JSON.parse(e.data);
        addLog('ok', 'âš¡', `Coordinator online Â· ${d.services} agents ready`);
      });

      sse.addEventListener('paying', e => {
        const d = JSON.parse(e.data);
        const mult = d.multiplier ? ` (${d.multiplier.toFixed(2)}x)` : '';
        addLog('pay', 'ğŸ’³', `Paying ${d.service} â€¦ ${d.amount} USDC${mult}`);
      });

      sse.addEventListener('result', e => {
        const d = JSON.parse(e.data);
        const tx = d.txHash ? ` Â· tx: ${shortHash(d.txHash)}` : (d.paid ? '' : ' (demo)');
        addLog('ok', 'âœ…', `${d.service} responded${tx}`);
        if (d.paid && d.txHash) {
          addTx({ service: d.service, txHash: d.txHash, paid: true });
        }
      });

      sse.addEventListener('alpha', e => {
        const d = JSON.parse(e.data);
        addLog('alpha', 'ğŸ¯', `Alpha synthesis complete Â· ${d.confidence} confidence`);
        showAlpha(d);
      });

      sse.addEventListener('staking', e => {
        const d = JSON.parse(e.data);
        addLog('alpha', 'âš–ï¸', `Staking settled: ${d.consensus.toUpperCase()} consensus Â· ${d.totalStaked.toFixed(0)} staked â†’ ${d.totalReturned.toFixed(0)} returned`);
        renderStaking(d);
      });

      sse.addEventListener('reputation', e => {
        const d = JSON.parse(e.data);
        addLog('ok', 'ğŸ†', 'Reputation updated');
        loadReputation();
      });

      sse.addEventListener('competition', e => {
        const d = JSON.parse(e.data);
        addLog('alpha', 'âš”ï¸', `Competition: ${d.winner} wins (${d.winnerRatio} vs ${d.loserRatio}) â€” ${d.reason}`);
        renderCompetition(d);
      });

      sse.addEventListener('cached', e => {
        const d = JSON.parse(e.data);
        addLog('ok', 'ğŸ“¦', `Report cached: ${d.reportId} Â· available at ${d.url} for ${d.sellPrice}`);
        setTimeout(loadReports, 500);
      });

      sse.addEventListener('error', e => {
        try { const d = JSON.parse(e.data); addLog('err', 'âŒ', d.message); } catch {}
      });

      sse.addEventListener('done', () => {
        sse.close();
        btn.disabled = false;
        btn.textContent = 'Hunt â†’';
        addLog('ok', 'ğŸ', 'Hunt complete');
      });

      sse.onerror = () => {
        sse.close();
        btn.disabled = false;
        btn.textContent = 'Hunt â†’';
      };
    }

    function showAlpha(d) {
      const result = document.getElementById('alpha-result');
      const rec = document.getElementById('alpha-rec');
      const conf = document.getElementById('alpha-conf');
      const signals = document.getElementById('alpha-signals');

      rec.textContent = d.recommendation;
      conf.textContent = `Confidence: ${d.confidence} (weighted: ${d.weightedConfidence?.toFixed(1) ?? '?'}%)`;

      const colors = {
        'strongly_bullish': '#10b981',
        'bullish': '#34d399',
        'HIGH_ALPHA': '#a855f7',
        'MEDIUM_ALPHA': '#f59e0b',
        'ACCUMULATION': '#06b6d4',
      };

      signals.innerHTML = (d.signals || []).map(s => {
        const col = Object.entries(colors).find(([k]) => s.includes(k));
        return `<span class="signal-tag" style="${col ? `border-color:${col[1]}40;color:${col[1]}` : ''}">${s}</span>`;
      }).join('');

      result.style.display = 'block';
    }

    // â”€â”€â”€ Tx log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function addTx(tx) {
      txLog.unshift(tx);
      if (txLog.length > 10) txLog.pop();
      renderTxList();
    }

    function renderTxList() {
      const list = document.getElementById('tx-list');
      if (!txLog.length) {
        list.innerHTML = '<div class="tx-empty">Transactions will appear here after a hunt</div>';
        return;
      }
      list.innerHTML = txLog.map(tx => `
        <div class="tx-item">
          <span class="tx-dir">OUT</span>
          <span class="tx-addr">${tx.service}</span>
          <span class="tx-hash">${shortHash(tx.txHash)}</span>
          <span class="tx-amount">USDC</span>
        </div>
      `).join('');
    }

    // â”€â”€â”€ Report modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    async function openReport(id) {
      document.getElementById('modal').classList.add('open');
      const body = document.getElementById('modal-body');
      body.innerHTML = '<div style="color:var(--text3);padding:2rem;text-align:center;">Loadingâ€¦</div>';

      try {
        const r = await fetch(`/report/${id}`);
        const d = await r.json();

        if (r.status === 402) {
          document.getElementById('modal-title').textContent = 'ğŸ”’ Locked Report';
          body.innerHTML = `
            <div class="buy-cta">
              <p>This report requires a payment of <strong>$0.01 USDC</strong> via x402 to unlock.</p>
              <p style="font-size:.75rem;color:var(--text3);margin-bottom:1rem;font-family:var(--mono);">Report ID: ${id}</p>
              <button class="btn btn-primary" onclick="copyEndpoint('${id}')">ğŸ“‹ Copy x402 Endpoint</button>
            </div>`;
          return;
        }

        document.getElementById('modal-title').textContent = `ğŸ“Š ${d.topic}`;
        const a = d.alpha || {};
        const b = a.breakdown || {};

        body.innerHTML = `
          <div class="report-detail-section">
            <div class="report-detail-label">Synthesis</div>
            <div style="font-size:1rem;font-weight:600;margin-bottom:.5rem">${a.recommendation || 'â€”'}</div>
            <div style="font-size:.85rem;color:var(--text2)">Confidence: <strong style="color:var(--accent2)">${a.confidence || 'â€”'}</strong></div>
          </div>

          <div class="report-detail-section">
            <div class="report-detail-label">Signals</div>
            <div class="alpha-signals" style="margin-top:.25rem">
              ${(a.signals||[]).map(s=>`<span class="signal-tag">${s}</span>`).join('')||'<span style="color:var(--text3)">No signals</span>'}
            </div>
          </div>

          ${b.news ? `
          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ“° News</div>
            <div class="breakdown-item"><span class="breakdown-key">Top headline</span><span class="breakdown-val">${b.news.topHeadline}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Articles found</span><span class="breakdown-val">${b.news.articleCount}</span></div>
          </div>` : ''}

          ${b.sentiment ? `
          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ’¬ Sentiment</div>
            <div class="breakdown-item"><span class="breakdown-key">Label</span><span class="breakdown-val">${b.sentiment.label}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Score</span><span class="breakdown-val">${b.sentiment.score}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Confidence</span><span class="breakdown-val">${b.sentiment.confidence}</span></div>
          </div>` : ''}

          ${b.polymarket ? `
          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ² Polymarket</div>
            <div class="breakdown-item"><span class="breakdown-key">Market</span><span class="breakdown-val">${b.polymarket.market}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Signal</span><span class="breakdown-val">${b.polymarket.signal}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">YES price</span><span class="breakdown-val">${b.polymarket.yesPrice}</span></div>
          </div>` : ''}

          ${b.whale ? `
          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ³ Whale Activity</div>
            <div class="breakdown-item"><span class="breakdown-key">Signal</span><span class="breakdown-val">${b.whale.signal}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Whale count</span><span class="breakdown-val">${b.whale.whaleCount}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Total volume</span><span class="breakdown-val">${b.whale.totalVolume}</span></div>
          </div>` : ''}

          ${b.defi ? `
          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ¦ DeFi</div>
            <div class="breakdown-item"><span class="breakdown-key">Asset</span><span class="breakdown-val">${b.defi.asset}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Action</span><span class="breakdown-val">${b.defi.action}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">24h change</span><span class="breakdown-val">${b.defi.change24h}</span></div>
          </div>` : ''}

          ${d.stakingSummary ? `
          <div class="report-detail-section">
            <div class="report-detail-label">âš–ï¸ Staking Results</div>
            <div class="breakdown-item"><span class="breakdown-key">Consensus</span><span class="breakdown-val">${d.stakingSummary.consensus.toUpperCase()}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Total Staked</span><span class="breakdown-val">${d.stakingSummary.totalStaked}</span></div>
            <div class="breakdown-item"><span class="breakdown-key">Total Returned</span><span class="breakdown-val" style="color:${d.stakingSummary.totalReturned >= d.stakingSummary.totalStaked ? 'var(--green)' : 'var(--red)'}">${d.stakingSummary.totalReturned}</span></div>
            ${(d.stakingSummary.results||[]).map(r => `
              <div class="breakdown-item">
                <span class="breakdown-key">${r.service}</span>
                <span class="breakdown-val" style="color:${r.correct?'var(--green)':'var(--red)'}">
                  ${r.correct?'âœ…':'âŒ'} ${r.direction} Â· ${r.staked}â†’${r.returned} Â· rep ${(r.reputationAfter*100).toFixed(1)}%
                </span>
              </div>
            `).join('')}
          </div>` : ''}

          <div class="report-detail-section">
            <div class="report-detail-label">ğŸ’¸ Agent Payments</div>
            ${(d.agentPayments?.breakdown||[]).map(p=>`
              <div class="breakdown-item">
                <span class="breakdown-key">${p.service}</span>
                <span class="breakdown-val" style="color:${p.paid?'var(--green)':'var(--text3)'}">
                  ${p.paid?'âœ…':'âš ï¸'} ${p.price}${p.txHash?` Â· ${shortHash(p.txHash)}`:''}
                </span>
              </div>
            `).join('')}
          </div>

          <div style="font-size:.72rem;color:var(--text3);font-family:var(--mono);padding-top:.75rem;border-top:1px solid var(--border)">
            Report ID: ${d.reportId} Â· ${d.timestamp}
          </div>
        `;
      } catch(e) {
        body.innerHTML = `<div style="color:var(--red)">Failed to load report</div>`;
      }
    }

    function copyEndpoint(id) {
      navigator.clipboard.writeText(`${location.origin}/report/${id}`);
      alert('Endpoint copied! Send $0.01 USDC via x402 to unlock.');
    }

    function closeModal(e) {
      if (!e || e.target === document.getElementById('modal')) {
        document.getElementById('modal').classList.remove('open');
      }
    }

    function shortHash(h) { return h ? h.slice(0,10)+'â€¦' : 'â€”'; }

    // â”€â”€â”€ Reputation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    const SERVICE_LABELS = {
      sentiment: 'ğŸ’¬ Sentiment v1',
      sentiment2: 'ğŸ’¬ Sentiment v2',
      polymarket: 'ğŸ² Polymarket',
      defi: 'ğŸ¦ DeFi',
      news: 'ğŸ“° News',
      whale: 'ğŸ³ Whale'
    };

    function sparklineSVG(history, w, h) {
      if (!history || history.length < 2) return '';
      const min = Math.min(...history) * 0.95;
      const max = Math.max(...history) * 1.05 || 1;
      const range = max - min || 0.01;
      const pts = history.map((v, i) => {
        const x = (i / (history.length - 1)) * w;
        const y = h - ((v - min) / range) * h;
        return `${x.toFixed(1)},${y.toFixed(1)}`;
      }).join(' ');
      const trending = history[history.length - 1] >= history[0];
      const color = trending ? 'var(--green)' : 'var(--red)';
      return `<div class="rep-sparkline"><svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><polyline points="${pts}" stroke="${color}" /></svg></div>`;
    }

    function renderRepGrid(agents) {
      const grid = document.getElementById('rep-grid');
      if (!agents || !agents.length) {
        grid.innerHTML = '<div style="color:var(--text3);font-size:.85rem;grid-column:1/-1;padding:1rem;text-align:center;">No reputation data</div>';
        return;
      }
      grid.innerHTML = agents.map(a => {
        const pct = (a.score * 100).toFixed(1);
        const pnlCls = a.pnl >= 0 ? 'rep-pnl-pos' : 'rep-pnl-neg';
        const pnlSign = a.pnl >= 0 ? '+' : '';
        return `
          <div class="rep-card" id="rep-${a.key}">
            <div class="rep-name">${SERVICE_LABELS[a.key] || a.key}</div>
            <div class="rep-score">${pct}%</div>
            <div class="rep-bar-outer"><div class="rep-bar-fill" style="width:${pct}%"></div></div>
            ${sparklineSVG(a.history, 120, 24)}
            <div class="rep-stats">
              <span class="${pnlCls}">${pnlSign}${a.pnl.toFixed(1)} P&L</span>
              <span>${a.correct}/${a.hunts}</span>
            </div>
          </div>`;
      }).join('');

      // Update avg reputation stat
      const avg = agents.reduce((s, a) => s + a.score, 0) / agents.length;
      document.getElementById('stat-reputation').textContent = (avg * 100).toFixed(0) + '%';

      // Update economy P&L stat
      const totalPnl = agents.reduce((s, a) => s + a.pnl, 0);
      const pnlEl = document.getElementById('stat-pnl');
      pnlEl.textContent = (totalPnl >= 0 ? '+' : '') + totalPnl.toFixed(1);
      pnlEl.style.color = totalPnl >= 0 ? 'var(--green)' : 'var(--red)';
    }

    function renderStaking(data) {
      if (!data) return;
      latestStaking = data;
      const card = document.getElementById('stake-card');
      card.classList.add('visible');

      const badge = document.getElementById('consensus-badge');
      badge.textContent = data.consensus.toUpperCase();
      badge.className = `consensus-badge consensus-${data.consensus}`;

      const rows = document.getElementById('stake-rows');
      rows.innerHTML = data.results.map(r => `
        <div class="stake-row">
          <span class="stake-svc">${SERVICE_LABELS[r.service] || r.service}</span>
          <span class="stake-dir ${r.direction}">${r.direction}</span>
          <span class="stake-num">${r.staked.toFixed(0)}</span>
          <span class="stake-num ${r.correct ? 'stake-correct' : 'stake-incorrect'}">${r.correct ? '+' : ''}${(r.returned - r.staked).toFixed(1)}</span>
          <span class="stake-num">${(r.reputationAfter * 100).toFixed(1)}%</span>
        </div>
      `).join('');

      // Animate reputation cards
      data.results.forEach(r => {
        const el = document.getElementById(`rep-${r.service}`);
        if (!el) return;
        el.classList.add('staked');
        setTimeout(() => {
          el.classList.remove('staked');
          el.classList.add(r.correct ? 'rewarded' : 'slashed');
          setTimeout(() => el.classList.remove('rewarded', 'slashed'), 2000);
        }, 600);
      });
    }

    async function loadReputation() {
      try {
        const r = await fetch('/reputation');
        const d = await r.json();
        renderRepGrid(d.agents);
      } catch(e) {}
    }

    function renderCompetition(data) {
      const card = document.getElementById('comp-card');
      card.classList.add('visible');

      const a1 = document.getElementById('comp-agent1');
      const a2 = document.getElementById('comp-agent2');
      const r1 = document.getElementById('comp-ratio1');
      const r2 = document.getElementById('comp-ratio2');
      const reason = document.getElementById('comp-reason');

      r1.textContent = data.winner === 'sentiment' ? data.winnerRatio : data.loserRatio;
      r2.textContent = data.winner === 'sentiment2' ? data.winnerRatio : data.loserRatio;

      a1.className = `comp-agent ${data.winner === 'sentiment' ? 'winner' : 'loser'}`;
      a2.className = `comp-agent ${data.winner === 'sentiment2' ? 'winner' : 'loser'}`;

      reason.textContent = data.reason;
    }

    // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function restartCountdown() {
      const el = document.getElementById('strip-countdown');
      el.style.animation = 'none';
      void el.offsetHeight; // trigger reflow
      el.style.animation = `spin ${POLL_INTERVAL / 1000}s linear infinite`;
    }

    async function pollStatus() {
      await Promise.all([loadServices(), loadReports(), loadReputation()]);
      restartCountdown();
    }

    async function init() {
      await pollStatus();
      setInterval(pollStatus, POLL_INTERVAL);
    }

    document.getElementById('hunt-topic').addEventListener('keydown', e => {
      if (e.key === 'Enter') runHunt();
    });

    init();
  </script>
</body>
</html>
