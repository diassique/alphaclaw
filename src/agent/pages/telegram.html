<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AlphaClaw â€” Telegram</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/dashboard.css" />
</head>
<body>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>

  <nav>
    <a class="logo" href="/">
      <div class="logo-icon"><img src="/logo.svg" alt="AlphaClaw" /></div>
      <div>AlphaClaw<div class="logo-sub">AI Alpha Marketplace</div></div>
    </a>
    <div class="nav-links">
      <a class="nav-link" href="/">Dashboard</a>
      <a class="nav-link" href="/hunt-page">Hunt</a>
      <a class="nav-link" href="/autopilot-page">Autopilot</a>
      <a class="nav-link" href="/reputation-page">Reputation</a>
      <a class="nav-link" href="/memory-page">Memory</a>
      <a class="nav-link" href="/network-page">Network</a>
      <a class="nav-link" href="/reports-page">Reports</a>
      <a class="nav-link" href="/telegram-page">Telegram</a>
    </div>
    <div class="nav-right">
      <span class="tg-badge tg-off" id="tg-badge" title="Telegram Bot">TG OFF</span>
      <span class="badge badge-green"><span class="dot"></span> LIVE</span>
      <span class="badge badge-purple">Base Sepolia &middot; x402</span>
    </div>
  </nav>

  <main>
    <div class="page-header">
      <h1><span>Telegram</span> Bot</h1>
      <p>Bot status, alert threshold configuration, and command reference.</p>
    </div>

    <!-- Bot Status -->
    <div class="section-title">Bot Status</div>
    <div class="panel" style="margin-bottom:2rem;">
      <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
        <div style="display:flex;align-items:center;gap:.5rem;">
          <div class="status-indicator" id="tg-status-dot" style="width:10px;height:10px;background:var(--text3);"></div>
          <span style="font-weight:700;font-family:var(--mono);font-size:.9rem;" id="tg-status-text">Checking...</span>
        </div>
        <span style="font-family:var(--mono);font-size:.8rem;color:var(--text3);" id="tg-chat-id"></span>
        <span style="font-family:var(--mono);font-size:.8rem;color:var(--text3);" id="tg-threshold-display"></span>
      </div>
    </div>

    <!-- Threshold Config -->
    <div class="section-title">Alert Threshold</div>
    <div class="panel" style="margin-bottom:2rem;">
      <p style="font-size:.85rem;color:var(--text2);margin-bottom:1rem;">Only send Telegram alerts when hunt confidence exceeds this threshold.</p>
      <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
        <input type="range" id="threshold-slider" min="0" max="100" value="70" style="flex:1;min-width:200px;accent-color:var(--accent);" oninput="document.getElementById('threshold-val').value = this.value" />
        <div style="display:flex;align-items:center;gap:.5rem;">
          <input type="number" id="threshold-val" min="0" max="100" value="70" style="width:60px;background:var(--bg3);border:1px solid var(--border2);border-radius:6px;padding:.4rem .5rem;color:var(--text);font-family:var(--mono);font-size:.85rem;text-align:center;" oninput="document.getElementById('threshold-slider').value = this.value" />
          <span style="color:var(--text3);font-size:.85rem;">%</span>
        </div>
        <button class="btn-sm btn-green" id="save-threshold" onclick="saveThreshold()">Save</button>
      </div>
      <div id="threshold-msg" style="font-size:.75rem;margin-top:.5rem;color:var(--text3);"></div>
    </div>

    <!-- Bot Commands -->
    <div class="section-title">Bot Commands</div>
    <div class="panel" style="margin-bottom:2rem;overflow-x:auto;">
      <table class="data-table">
        <thead><tr><th>Command</th><th>Description</th><th>Example</th></tr></thead>
        <tbody>
          <tr><td style="color:var(--accent2)">/hunt &lt;topic&gt;</td><td>Run a full alpha hunt on the given topic</td><td style="color:var(--text3)">/hunt Bitcoin ETF approval</td></tr>
          <tr><td style="color:var(--accent2)">/status</td><td>Show network status, wallet, circuits, and autopilot state</td><td style="color:var(--text3)">/status</td></tr>
          <tr><td style="color:var(--accent2)">/reputation</td><td>Show all agent reputation scores and P&amp;L</td><td style="color:var(--text3)">/reputation</td></tr>
          <tr><td style="color:var(--accent2)">/autopilot</td><td>Toggle autopilot on/off</td><td style="color:var(--text3)">/autopilot</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Webhook Setup -->
    <div class="section-title">Webhook Setup</div>
    <div class="panel" style="margin-bottom:2rem;">
      <div style="font-size:.85rem;color:var(--text2);line-height:1.8;">
        <p style="margin-bottom:.75rem;">To connect your Telegram bot to AlphaClaw:</p>
        <ol style="padding-left:1.5rem;color:var(--text2);">
          <li>Create a bot via <span style="color:var(--accent2)">@BotFather</span> on Telegram</li>
          <li>Set environment variables:
            <div style="background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:.75rem;margin:.5rem 0;font-family:var(--mono);font-size:.75rem;color:var(--text);">
              TELEGRAM_BOT_TOKEN=your_bot_token<br/>
              TELEGRAM_CHAT_ID=your_chat_id
            </div>
          </li>
          <li>Set the webhook URL:
            <div style="background:var(--bg3);border:1px solid var(--border);border-radius:8px;padding:.75rem;margin:.5rem 0;font-family:var(--mono);font-size:.75rem;color:var(--text);">
              curl -X POST "https://api.telegram.org/bot{TOKEN}/setWebhook" \<br/>
              &nbsp;&nbsp;-d "url=https://your-server:5000/telegram/webhook"
            </div>
          </li>
          <li>Restart the coordinator. The TG badge in the nav will show <span class="tg-badge tg-on" style="display:inline-flex;">TG ON</span> when connected.</li>
        </ol>
      </div>
    </div>

    <!-- Alert Preview -->
    <div class="section-title">Alert Preview</div>
    <div class="panel" style="margin-bottom:2rem;">
      <p style="font-size:.8rem;color:var(--text3);margin-bottom:.75rem;">When confidence exceeds the threshold, alerts look like this:</p>
      <div style="background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:1rem;font-family:var(--mono);font-size:.78rem;line-height:1.6;color:var(--text);">
        <div style="color:var(--accent2);font-weight:700;margin-bottom:.5rem;">AlphaClaw Alert</div>
        <div>Topic: <span style="color:var(--text);">Bitcoin ETF approval</span></div>
        <div>Recommendation: <span style="color:var(--green);">STRONGLY BULLISH</span></div>
        <div>Confidence: <span style="color:var(--accent2);">HIGH (82.5%)</span></div>
        <div style="margin-top:.5rem;">Signals:</div>
        <div style="color:var(--text2);padding-left:.5rem;">
          &bull; strongly_bullish sentiment (0.85)<br/>
          &bull; HIGH_ALPHA polymarket (YES: $0.78)<br/>
          &bull; ACCUMULATION defi momentum<br/>
          &bull; whale accumulation detected
        </div>
        <div style="margin-top:.5rem;color:var(--text3);font-size:.7rem;">Report: abc123def &middot; $0.01 via x402</div>
      </div>
    </div>
  </main>

  <!-- Status Strip -->
  <div class="status-strip" id="status-strip">
    <div class="status-strip-left">
      <div class="status-indicator loading" id="strip-indicator"></div>
      <span class="status-label loading" id="strip-label">Checking...</span>
    </div>
    <div class="status-dots" id="strip-dots"></div>
    <div class="status-meta">
      <span id="strip-latency">--</span> &middot; <span id="strip-checked">checking</span> &middot; <span class="status-countdown" id="strip-countdown"></span>
    </div>
  </div>

  <footer>
    <span>AlphaClaw Network &middot; Base Sepolia &middot; x402</span>
    <span>SURGE x OpenClaw Hackathon 2026</span>
  </footer>

  <script src="/dashboard.js"></script>
  <script>
    async function loadTelegramStatus() {
      try {
        const r = await fetch('/telegram/status');
        const d = await r.json();
        const dot = document.getElementById('tg-status-dot');
        const text = document.getElementById('tg-status-text');
        const chatId = document.getElementById('tg-chat-id');
        const threshold = document.getElementById('tg-threshold-display');

        if (d.enabled) {
          dot.className = 'status-indicator ok';
          dot.style.width = '10px'; dot.style.height = '10px';
          text.textContent = 'CONNECTED';
          text.style.color = 'var(--green)';
          chatId.textContent = `Chat ID: ${d.chatId || '\u2014'}`;
        } else {
          dot.style.background = 'var(--text3)';
          text.textContent = 'NOT CONFIGURED';
          text.style.color = 'var(--text3)';
          chatId.textContent = '';
        }

        const t = d.alertThreshold ?? 70;
        threshold.textContent = `Threshold: ${t}%`;
        document.getElementById('threshold-slider').value = t;
        document.getElementById('threshold-val').value = t;

        // Also update nav badge
        const badge = document.getElementById('tg-badge');
        if (d.enabled) {
          badge.className = 'tg-badge tg-on';
          badge.textContent = 'TG ON';
        } else {
          badge.className = 'tg-badge tg-off';
          badge.textContent = 'TG OFF';
        }
      } catch {}
    }

    async function saveThreshold() {
      const val = Number(document.getElementById('threshold-val').value);
      const msg = document.getElementById('threshold-msg');
      try {
        const r = await fetch('/telegram/threshold', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ threshold: val })
        });
        if (r.ok) {
          msg.textContent = `Threshold saved: ${val}%`;
          msg.style.color = 'var(--green)';
          loadTelegramStatus();
        } else {
          msg.textContent = 'Failed to save';
          msg.style.color = 'var(--red)';
        }
      } catch {
        msg.textContent = 'Error saving threshold';
        msg.style.color = 'var(--red)';
      }
    }

    loadStatusStrip();
    loadTelegramStatus();
  </script>
</body>
</html>
